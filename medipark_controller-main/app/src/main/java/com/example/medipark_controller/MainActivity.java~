package com.example.medipark_controller;

import android.annotation.SuppressLint;
import android.content.Context;
import android.content.SharedPreferences;
import android.graphics.Color;
import android.media.MediaPlayer;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageButton;

import androidx.activity.EdgeToEdge;
import androidx.appcompat.app.AppCompatActivity;

import com.google.gson.Gson;


public class MainActivity extends AppCompatActivity {


    public final float normalTextSize=50.0f;
    public int backgroundColor=Color.WHITE;
    public int textColor=Color.BLACK;
    static String page="controller";


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        EdgeToEdge.enable(this);
        setContentView(R.layout.activity_main);

        @SuppressLint({"MissingInflatedId", "LocalSuppress"}) ViewGroup highestLayout=findViewById(R.id.highest_layout);


        String[] modeDatas={"M1","M2","M3","M4","M5","M6","M7","M8","M9","M10"};
        String[] energyDatas={"5","10","15","20","25","30","35","40","45","50"};
        String[] frequencyDatas={"0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9","1.0","1.1"
                                ,"1.2","1.3","1.4","1.5","1.6","1.7","1.8","1.9","2.0"};
        String[] pulseWidthDatas={"0.3","0.6","0.9","1.2","1.5","1.8","2.1","2.4","2.7","3.0"};

        Controller modeController=findViewById(R.id.mode_controller);
        modeController.init(MainActivity.this,modeDatas,R.raw.scroll_sound,"MODE");

        Controller energyController=findViewById(R.id.energy_controller);
        energyController.init(MainActivity.this,energyDatas,R.raw.scroll_sound,"ENERGY");

        Controller frequencyController=findViewById(R.id.frequency_controller);
        frequencyController.init(MainActivity.this,frequencyDatas,R.raw.scroll_sound,"FREQUENCY");

        Controller pulseWidthController=findViewById(R.id.pulse_width_controller);
        pulseWidthController.init(MainActivity.this,pulseWidthDatas,R.raw.scroll_sound,"PULSE WIDTH");

        SharedPreferences sharedPreferences = getApplicationContext().getSharedPreferences("SharedPrefs", Context.MODE_PRIVATE);
        SharedPreferences.Editor editor=sharedPreferences.edit();

        modeController.getPicker().setOnValueChangedListener(new Picker.OnValueChangeListener() {
            @Override
            public void onValueChange(Picker picker, int oldVal, int newVal) {
                String loadedJson = sharedPreferences.getString(modeController.getSelectedValue(), null);
                if(loadedJson==null){
                    energyController.getPicker().setValue(0);
                    frequencyController.getPicker().setValue(0);
                    pulseWidthController.getPicker().setValue(0);
                } else{
                    Gson gson = new Gson();
                    SaveModel saveModel = gson.fromJson(loadedJson, SaveModel.class);
                    energyController.getPicker().setValue(saveModel.energyIndex);
                    frequencyController.getPicker().setValue(saveModel.frequencyIndex);
                    pulseWidthController.getPicker().setValue(saveModel.pulseWidthIndex);
                }
                MediaPlayer mediaPlayer = MediaPlayer.create(MainActivity.this, R.raw.scroll_sound);
                mediaPlayer.start();

                // 재생이 끝나면 리소스 해제
                mediaPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() {
                    @Override
                    public void onCompletion(MediaPlayer mp) {
                        mediaPlayer.release();
                    }
                });
            }
        });
        LayoutInflater inflater=getLayoutInflater();
        ImageButton menuButton=findViewById(R.id.menu_button);
        View controllerLayout=findViewById(R.id.controller_layout);
        View menuHeader=inflater.inflate(R.layout.menu_header_field,highestLayout,false);
        MenuPage menuPage=new MenuPage(this,modeDatas);
        menuButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                if(page.equals("controller")){
                    highestLayout.removeView(controllerLayout);
                    page="menu";
                    highestLayout.addView(menuHeader);
                    highestLayout.addView(menuPage);
                }else if(page.equals("menu")){
                    highestLayout.removeView(menuHeader);
                    highestLayout.removeView(menuPage);
                    page="controller";
                    highestLayout.addView(controllerLayout);
                }
            }
        });

        ImageButton saveButton=findViewById(R.id.save_button);
        saveButton.setOnClickListener(new View.OnClickListener(){
            @Override
            public void onClick(View v){
                Gson gson=new Gson();
                SaveModel saveModel
            }
        });

    }







}